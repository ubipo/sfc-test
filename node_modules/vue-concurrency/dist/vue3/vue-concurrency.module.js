import{computed as n,reactive as e,watch as r,onUnmounted as t,getCurrentInstance as i}from"vue";import u from"caf";function c(){return(c=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n}).apply(this,arguments)}function o(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function s(n){var e=0;if("undefined"==typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(n=function(n,e){if(n){if("string"==typeof n)return o(n,void 0);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(n,void 0):void 0}}(n)))return function(){return e>=n.length?{done:!0}:{done:!1,value:n[e++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(e=n[Symbol.iterator]()).next.bind(e)}function a(n){return new Promise(function(e){var t=r(n,function(n){null!=n&&(e(n),t&&t())},{immediate:!0})})}var f=function(n){return n._runningInstances.length>=n._maxConcurrency},l=function(n){var e=n._activeInstances[0];e&&e.cancel()},p=function(n){n._enqueuedInstances.forEach(function(n){n.isEnqueued=!1,n.isDropped=!0})};function d(e,r){return r?function(e,r,t){return n(function(){return e().filter(function(n){return n[r]})})}(function(){return e()._instances},r):n(function(){return[]})}function _(e){return n(function(){return e().length})}function v(e){return n(function(){var n=e();return n[n.length-1]})}function g(e){return n(function(){return e()[0]})}function h(n){return e(n)}function m(n){var e="General";n._isDropping&&(e="Drop"),n._isEnqueuing&&(e="Enqueue"),n._isRestartable&&(e="Restartable"),n._isKeepingLatest&&(e="KeepLatest");var r=e+" Task";"General"!==e&&(r=r+" with maxConcurrency "+n._maxConcurrency);var t=n._instances.map(function(n){var e;return n.isSuccessful?e="üçè":n.isRunning||n.isEnqueued?e="üçä":(n.isError||n.isCanceled||n.isDropped)&&(e="üî¥"),{status:e+" "+n.status,value:n.value,error:n.error}});console.log("üö¶ "+r),console.table(t)}function y(n){return"test"===process.env.NODE_ENV?Promise.resolve():new Promise(function(e){return setTimeout(e,n)})}function b(n,e){return new n.CancelToken(function(n){e.pr.catch(function(e){"cancel"===e&&n()})})}function w(n){return R(regeneratorRuntime.mark(function e(r){var t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.apply(void 0,[r].concat([].slice.call(t,1))));case 1:case"end":return e.stop()}},e)}))}function E(e,r,t){var i,c,o=h({id:t.id,isDropped:!1,isEnqueued:!1,hasStarted:!1,isRunning:!1,isFinished:!1,isCanceling:!1,isCanceled:n(function(){return o.isCanceling&&o.isFinished}),isActive:n(function(){return o.isRunning&&!o.isCanceling}),isSuccessful:!1,isNotDropped:n(function(){return!o.isDropped}),isError:n(function(){return!!o.error}),status:n(function(){var n=[[o.isRunning,"running"],[o.isEnqueued,"enqueued"],[o.isCanceled,"canceled"],[o.isCanceling,"canceling"],[o.isDropped,"dropped"],[o.isError,"error"],[o.isSuccessful,"success"]].find(function(n){return n[0]});return n&&n[1]}),error:null,value:null,cancel:function(){o.isCanceling=!0,o.isEnqueued&&(o.isFinished=!0),o.isEnqueued=!1,o.token&&o.token.abort("cancel")},canceledOn:function(n){return n.pr.catch(function(n){o.cancel()}),o},_run:function(){!function(n,e,r,t){var i=new u.cancelToken,c=u(e,i);function o(){n.isRunning=!1,n.isFinished=!0}n.token=i,n.hasStarted=!0,n.isRunning=!0,n.isEnqueued=!1,c.call.apply(c,[n,i].concat(r)).then(function(e){n.value=e,n.isSuccessful=!0,o(),n._deferredObject.resolve(e),t.onFinish(n)}).catch(function(e){"cancel"!==e&&(n.error=e),o(),n._shouldThrow&&n._deferredObject.reject(e),t.onFinish(n)})}(o,e,r,t)},_handled:!0,_deferredObject:(i={},c=new Promise(function(n,e){i.resolve=n,i.reject=e}),i.promise=c,i),_shouldThrow:!1,then:function(n,e){return o._shouldThrow=!0,o._deferredObject.promise.then(n,e)},catch:function(n){return o._shouldThrow=!0,o._deferredObject.promise.catch(n)},finally:function(n){return o._shouldThrow=!0,o._deferredObject.promise.finally(n)}}),s=t.modifiers;return s.drop?o.isDropped=!0:s.enqueue?o.isEnqueued=!0:o._run(),o}function R(e){var r=h({_isRestartable:!1,_isDropping:!1,_isEnqueuing:!1,_isKeepingLatest:!1,_maxConcurrency:1,_hasConcurrency:n(function(){return r._isRestartable||r._isDropping||r._isEnqueuing||r._isKeepingLatest}),isIdle:n(function(){return!r.isRunning}),isRunning:n(function(){return!!r._instances.find(function(n){return n.isRunning})}),isError:n(function(){return!(!r.last||!r.last.isError)}),_instances:[],_successfulInstances:d(function(){return r},"isSuccessful"),_runningInstances:d(function(){return r},"isRunning"),_enqueuedInstances:d(function(){return r},"isEnqueued"),_notDroppedInstances:d(function(){return r},"isNotDropped"),_activeInstances:d(function(){return r},"isActive"),performCount:_(function(){return r._instances}),last:v(function(){return r._notDroppedInstances}),lastSuccessful:v(function(){return r._successfulInstances}),firstEnqueued:g(function(){return r._enqueuedInstances}),cancelAll:function(){r._instances.forEach(function(n){try{n.isDropped||n.isFinished||n.cancel()}catch(n){if("cancel"!==n)throw n}})},perform:function(){var n={enqueue:!1,drop:!1};r._hasConcurrency&&f(r)&&(r._isDropping&&(n.drop=!0),r._isRestartable&&l(r),r._isKeepingLatest&&p(r),(r._isEnqueuing||r._isKeepingLatest)&&(n.enqueue=!0));var t=function(){return q(r)},i=E(e,[].slice.call(arguments),{modifiers:n,onFinish:t,id:r._instances.length+1});return r._instances=[].concat(r._instances,[i]),i},clear:function(){this.cancelAll(),this._instances=[]},restartable:function(){return r._resetModifierFlags(),r._isRestartable=!0,r},drop:function(){return r._resetModifierFlags(),r._isDropping=!0,r},enqueue:function(){return r._resetModifierFlags(),r._isEnqueuing=!0,r},keepLatest:function(){return r._resetModifierFlags(),r._isKeepingLatest=!0,r},_resetModifierFlags:function(){r._isKeepingLatest=!1,r._isRestartable=!1,r._isEnqueuing=!1,r._isDropping=!1},maxConcurrency:function(n){return r._maxConcurrency=n,r}});return t(function(){r._instances&&r.cancelAll()}),r}function q(n){if(n._isEnqueuing||n._isKeepingLatest){var e=n.firstEnqueued;e&&e._run()}}function C(n){return R(regeneratorRuntime.mark(function e(r){var t,i,u,c,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.perform.apply(n,[].slice.call(o,1)).canceledOn(r);case 2:t=e.sent,i=s([].slice.call(o,1));case 4:if((u=i()).done){e.next=11;break}return c=u.value,e.next=8,c.perform(t).canceledOn(r);case 8:t=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e)}))}function x(){return R(regeneratorRuntime.mark(function n(e){var r,t=arguments,i=arguments;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=[].slice.call(i).map(function(n){return n.perform.apply(n,[].slice.call(t,1)).canceledOn(e)}),n.next=3,Promise.all(r);case 3:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},n)}))}function O(){return R(regeneratorRuntime.mark(function n(e){var r,t,i,u,c=arguments;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=[],t=s([].slice.call(c));case 2:if((i=t()).done){n.next=11;break}return u=i.value,n.t0=r,n.next=7,u.perform.apply(u,[].slice.call(c,1)).canceledOn(e);case 7:n.t1=n.sent,n.t0.push.call(n.t0,n.t1);case 9:n.next=2;break;case 11:return n.abrupt("return",r);case 12:case"end":return n.stop()}},n)}))}var j=function(){return"undefined"==typeof window};function D(n){n._deferredObject.promise=n.isError?Promise.reject(n.error):Promise.resolve(n.value),n.cancel=function(){},n.canceledOn=function(){return n},n._run=function(){},n.then=function(){var e;return(e=n._deferredObject.promise).then.apply(e,[].slice.call(arguments))},n.catch=function(){var e;return(e=n._deferredObject.promise).catch.apply(e,[].slice.call(arguments))},n.finally=function(){var e;return(e=n._deferredObject.promise).finally.apply(e,[].slice.call(arguments))}}function S(n,e){if(j()){var r=e.perform();return function(n){throw new Error("vue-concurrency SSR features are not supported in Vue 3 so far")}(),r}return I(n,e).reverse()[0]||e.perform()}function I(n,e){var r=function(n){if(!k())throw Error("Could not access  window.__NUXT__");return k().vueConcurrency[n].value}(n);return r&&(e._instances=r.instances||[],e._instances.forEach(D),function(n){delete k().vueConcurrency[n]}(n)),e._instances}function k(){return window.__NUXT__}function F(e,r){j()?function(e,r){var t=i().$root,u=t&&t.context&&t.context.nuxtState;if(!u)throw new Error("Could not access $root.context.nuxtState");u.vueConcurrency||(u.vueConcurrency={}),u.vueConcurrency[e]=n(function(){return{instances:r._instances}})}(e,r):I(e,r)}function T(r){var t=Object.values(r),i=e(c({isRunning:n(function(){return!!t.find(function(n){return n.isRunning})}),isIdle:n(function(){return!i.isRunning})},r));return i}export{b as getCancelToken,m as printTask,y as timeout,w as useAsyncTask,x as useParallelTask,C as usePipeTask,F as useSSRPersistance,O as useSequentialTask,R as useTask,T as useTaskGroup,S as useTaskPrefetch,a as waitForValue};
//# sourceMappingURL=vue-concurrency.module.js.map
