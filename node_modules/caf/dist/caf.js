/*! caf.js
	v9.1.0 (c) 2020 Kyle Simpson
	MIT License: http://getify.mit-license.org
*/

!function UMD(n,e,r){"function"==typeof define&&define.amd?define(r):"undefined"!=typeof module&&module.exports?module.exports=r(n,e):e[n]=r(n,e)}("CAF",this,(function DEF(n,e){"use strict";class r{constructor(n=new AbortController){this.controller=n,this.signal=n.signal;this.signal.pr=new Promise((n,e)=>{once(this.signal,"abort",n=>{"reason"in this.signal||(this.signal.reason=n),e(n)}),this.rej=e}),this.signal.pr.catch(n=>n)}abort(n){"reason"in this.signal||(this.signal.reason=n),this.rej(n),this.controller.abort()}}const o=Symbol("Timeout Token");return Object.assign(CAF,{cancelToken:r,delay:delay,timeout:function timeout(n,e="Timeout"){n=Number(n)||0;var i=new r;return delay(i.signal,n).then(cleanup,cleanup),Object.defineProperty(i,o,{value:!0,writable:!1,enumerable:!1,configurable:!1}),i;function cleanup(){i.abort(e),i=null}},signalRace:function signalRace(n){var e=new r;return Promise.race(n.map(getSignalPr)).catch(e.abort.bind(e)),e.signal},signalAll:function signalAll(n){var e=new r,o=n.map((function normalize(n){return getSignalPr(n).catch(n=>n)}));return Promise.all(o).then(e.abort.bind(e)),e.signal}}),CAF;function CAF(n){return function instance(e,...r){var i,a;if(({tokenOrSignal:e,signal:i,signalPr:a}=processTokenOrSignal(e)),i.aborted)return a;var l=a.catch((function onCancelation(n){try{var e=u.return();throw void 0!==e.value?e.value:n}finally{u=s=l=f=null}})),{it:u,result:s}=_runner.call(this,n,i,...r),f=Promise.race([s,l]);return e!==i&&e[o]?f.then((function t(){e.abort()}),(function c(){e.abort()})):f.catch(Function.prototype),i=r=null,f}}function delay(n,e){var r,o;return"number"==typeof n&&"number"!=typeof e&&([e,n]=[n,e]),n&&({tokenOrSignal:n,signal:r,signalPr:o}=processTokenOrSignal(n)),r&&r.aborted?o:new Promise((function c(n,i){r&&o.catch((function onAbort(){a&&(clearTimeout(a),i(`delay (${e}) interrupted`)),n=i=a=r=null}));var a=setTimeout((function onTimeout(){n("delayed: "+e),n=i=a=r=null}),e)}))}function getSignalPr(n){return n.pr||new Promise((function c(e,r){once(n,"abort",r)}))}function once(n,e,r){n.addEventListener(e,(function onEvt(...o){n.removeEventListener(e,onEvt),r(...o)}))}function processTokenOrSignal(n){n instanceof AbortController&&(n=new r(n));var e=n&&n instanceof r?n.signal:n;return{tokenOrSignal:n,signal:e,signalPr:getSignalPr(e)}}function _runner(n,...e){var r=n.apply(this,e);return n=e=null,{it:r,result:function getNextResult(n){try{var e=r.next(n);n=null}catch(n){return Promise.reject(n)}return function processResult(n){var e=Promise.resolve(n.value);return n.done?r=null:(e=e.then(getNextResult,(function onRejection(n){return Promise.resolve(r.throw(n)).then(processResult)}))).catch((function cleanup(){r=null})),n=null,e}(e)}()}}}));